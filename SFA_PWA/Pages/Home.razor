
@page "/"

<PageTitle>Home</PageTitle>

@if (showSplash)
{
    <div class="splash-overlay" @onclick="HideSplash">
        <img src="sfa.png" alt="App Icon" class="splash-icon" />
    </div>
}

<h1>Welcome to the San Fairy Ann Cycling Club App!</h1>

<div class="instructions">
    <h3>How to use this app:</h3>
    <ul>
        <li><b>Ride Group Calendars:</b> View upcoming rides for your selected groups on the <b>Calendars</b> page. Choose which groups to follow in <b>Settings</b>.</li>
        <li><b>Club Links:</b> Access club resources, WhatsApp channels (demo only), social media, and more from the <b>Links</b> page. Use the filter box to quickly find any link or resource.</li>
        <li><b>Weather:</b> Check the forecast for Maidstone, Kent, for the next Wednesday, Saturday, or Sunday on the <b>Weather</b> page. Quick links to major UK weather sites are also provided.</li>
        <li><b>Groups/Settings:</b> Select which ride groups you want to follow. Your preferences are saved locally.</li>
        <li><b>Cafe List:</b> Browse recommended cafes for your rides.</li>
        <li><b>Specification:</b> Review the app’s specification and details.</li>
        <li><b>Feedback:</b> For feedback or issues, use the GitHub link in the <b>Links</b> page.</li>
    </ul>
    <p><i>Note: WhatsApp group links are for demonstration only and not yet set up for the club. This app works on desktop and mobile, and saves your settings locally for convenience.</i></p>
</div>

<div class="desktop-bottom-image">
    <img src="DGroupJune7.png" alt="DGroup June 7" />
</div>


<footer style="text-align:center; margin-top:2em; color:gray; font-size:0.9em;">
    <div>
        .NET Version: @AppVersion | Last Published: @BuildDate
    </div>
</footer>

@inject IJSRuntime JS

@code {
    private bool showSplash = true;

    private string? AppVersion;
    private string? BuildDate;

    protected override async void OnInitialized()
    {
        // Start a timer to hide splash after 5 seconds
        _ = HideSplashAfterDelayAsync();

        await LoadBuildInfoAsync();
    }

    private async Task LoadBuildInfoAsync()
    {
        try
        {
            var buildInfo = await JS.InvokeAsync<BuildInfo>("fetchBuildInfo");
            AppVersion = buildInfo?.DotNetVersion ?? "Unknown";
            BuildDate = buildInfo?.BuildDate != null ? FormatDate(buildInfo.BuildDate) : "Unknown";
        }
        catch
        {
            AppVersion = "Unknown";
            BuildDate = "Unknown";
        }
        StateHasChanged();
    }

    private string FormatDate(string isoDate)
    {
        if (DateTime.TryParse(isoDate, out var dt))
        {
            return dt.ToLocalTime().ToString("yyyy-MM-dd HH:mm");
        }
        return isoDate;
    }

    private async Task HideSplashAfterDelayAsync()
    {
        await Task.Delay(5000);
        showSplash = false;
        StateHasChanged();
    }

    private void HideSplash()
    {
        showSplash = false;
    }

    private class BuildInfo
    {
        public string? DotNetVersion { get; set; }
        public string? BuildDate { get; set; }
    }
}



