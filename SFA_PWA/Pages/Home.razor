
@page "/"

<PageTitle>Home</PageTitle>

@if (showSplash)
{
    <div class="splash-overlay" @onclick="HideSplash">
        <img src="sfa.png" alt="App Icon" class="splash-icon" />
    </div>
}

<h1>Welcome to the San Fairy Ann Cycling Club App!</h1>

<div class="instructions">
    <h3>How to use this app:</h3>
    <ul>
        <li><b>Ride Info:</b> Find upcoming ride routes and schedules on the <b>Calendars</b> page.</li>
        <li><b>Links:</b> Access club resources, WhatsApp channels, social media, and more from the <b>Links</b> page.</li>
        <li><b>Weather:</b> Check forecasts for ride days on the <b>Weather</b> page.</li>
        <li><b>Settings:</b> Save your preferences and filter rides by group or location.</li>
        <li><b>Search:</b> Use the filter box to quickly find any link or resource.</li>
        <li><b>Custom Links:</b> Add your own favorite cycling resources.</li>
        <li><b>Help:</b> For feedback or issues, use the GitHub link in the app menu.</li>
    </ul>
    <p>Explore the navigation menu to discover all features. This app works on desktop and mobile, and saves your settings locally for convenience.</p>
</div>

<div class="desktop-bottom-image">
    <img src="DGroupJune7.png" alt="DGroup June 7" />
</div>


<footer style="text-align:center; margin-top:2em; color:gray; font-size:0.9em;">
    <div>
        .NET Version: @AppVersion | Last Published: @BuildDate
    </div>
</footer>

@inject IJSRuntime JS

@code {
    private bool showSplash = true;

    private string? AppVersion;
    private string? BuildDate;

    protected override async void OnInitialized()
    {
        // Start a timer to hide splash after 5 seconds
        _ = HideSplashAfterDelayAsync();

        await LoadBuildInfoAsync();
    }

    private async Task LoadBuildInfoAsync()
    {
        try
        {
            var buildInfo = await JS.InvokeAsync<BuildInfo>("fetchBuildInfo");
            AppVersion = buildInfo?.DotNetVersion ?? "Unknown";
            BuildDate = buildInfo?.BuildDate != null ? FormatDate(buildInfo.BuildDate) : "Unknown";
        }
        catch
        {
            AppVersion = "Unknown";
            BuildDate = "Unknown";
        }
        StateHasChanged();
    }

    private string FormatDate(string isoDate)
    {
        if (DateTime.TryParse(isoDate, out var dt))
        {
            return dt.ToLocalTime().ToString("yyyy-MM-dd HH:mm");
        }
        return isoDate;
    }

    private async Task HideSplashAfterDelayAsync()
    {
        await Task.Delay(5000);
        showSplash = false;
        StateHasChanged();
    }

    private void HideSplash()
    {
        showSplash = false;
    }

    private class BuildInfo
    {
        public string? DotNetVersion { get; set; }
        public string? BuildDate { get; set; }
    }
}



